rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // User chỉ có thể đọc/ghi dữ liệu của mình
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // Cho phép đọc/ghi subcollections của user
      match /provinces/{provinceId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
      
      // Cho phép đọc/ghi game progress
      match /gameProgress/{document} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }
    
    // Cho phép đọc/ghi collection test cho debugging
    match /test/{document} {
      allow read, write: if request.auth != null;
    }
    
    // Cho phép đọc dữ liệu tỉnh thành (public data)
    match /provinces/{provinceId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Cho phép đọc daily challenges (public data)
    match /dailyChallenges/{challengeId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Cho phép đọc/ghi user achievements
    match /users/{userId}/achievements/{achievementId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Cho phép đọc/ghi user statistics
    match /users/{userId}/statistics/{statId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Cho phép đọc/ghi user settings
    match /users/{userId}/settings/{settingId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Cho phép đọc/ghi user game history
    match /users/{userId}/gameHistory/{gameId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Cho phép đọc/ghi user leaderboard entries
    match /users/{userId}/leaderboard/{entryId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Global leaderboard - cho phép đọc tất cả, chỉ ghi của mình
    match /leaderboard/{entryId} {
      allow read: if true;
      allow write: if request.auth != null && 
        request.auth.uid == resource.data.userId;
    }
    
    // Global achievements - cho phép đọc tất cả
    match /achievements/{achievementId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Global statistics - cho phép đọc tất cả
    match /statistics/{statId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
  }
} 